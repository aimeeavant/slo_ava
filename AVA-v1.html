<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Central Coast AVAs</title>

    <!-- Meta  -->
    <meta name="description" content="An interactive guide to Central Coast AVAs">

    <!-- Layout Framework  -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- Custom Styles  -->
    <link rel="stylesheet" href="css/layout.css">

    <!-- Leaflet Styles  -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />

    <!-- Fonts  -->
    <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>

</head>

<body>
    <div class="row">
        <div id="heading" class="col-md-12">
            <h1>Establishment of AVAs in SLO County</h1>
        </div>
    </div>

    <div class="row">
        <div id="sidebar" class="col-md-2">
            <h3>AVAs</h3>
            <button id='btnEV' class='btn btn-primary btn-block'>Edna Valley</button>
            <button id='btnPR' class='btn btn-primary btn-block'>Paso Robles</button>
            <button id='btnYM' class='btn btn-primary btn-block'>York Mountain</button>
            <button id='btnAGV' class='btn btn-primary btn-block'>Arroyo Grande Valley</button>
            <div id="info"></div>
        </div>
        <div id="map" class="col-md-10"></div>
    </div>
    <div class="row">
        <div id="footer" class="col-md-12">
            <h2>Notes</h2>
            <p>Data obtained from ttb.gov as shapefiles and PDF files.</p>
            <p>Loaded into QGIS. Used Vectors>Data Managment Tools>Merge Vector Layers to create a single shape file. Exported as a GeoJson.</p>

        </div><!--  end footer div -->
    </div>


    <!-- add javascript libraries -->
    <!-- JQuery library -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- Leaflet JS  --- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <!-- add the simple stats library -->
    <script src="https://unpkg.com/simple-statistics@7.2.0/dist/simple-statistics.min.js"></script>
    <!-- Javascript Custom -->



    <script>
        // Map Options
        var options = {
            //center: [35.5528, -120.8266],
            //zoom: 8.4,
            zoomSnap: .1,
            zoomControl: true,
            dragging: true,
            doubleClickZoom: true,
            //minZoom: 7.4, // why does this work, docs say applies to tile layers
            //maxZoom: 7.4,
            attributionControl: true
        }
        // Map Constructor
        var map = L.map('map', options);

        // Mapbox custom tile layer
        var xyzURL = 'https://api.mapbox.com/styles/v1/aimeeavant/cjurqkcb817u61fpl4hvm7g8q/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoiYWltZWVhdmFudCIsImEiOiJjajd2ZWp3NjQwNGx4MndudjVqbGd1ZG1xIn0.5j60jT7XVIkSKpw7Y9aJXA';
        var tiles = L.tileLayer(xyzURL, {
            //no options
        });
        tiles.addTo(map);


        // add scale bar
        L.control.scale({ metric: false, position: 'topright', maxWidth: 200 }).addTo(map);
        // add zoom level output
        var ZoomViewer = L.Control.extend({
            onAdd: function () {
                var gauge = L.DomUtil.create('div');
                // gauge.style.width = '200px';
                // gauge.style.background = 'rgba(255,255,255,0.5)';
                gauge.style.textAlign = 'left';
                map.on('zoomstart zoom zoomend', function (ev) {
                    gauge.innerHTML = 'Zoom Level: ' + map.getZoom();
                })
                return gauge;
            }
        });
        (new ZoomViewer).addTo(map);

        // -------- Add Data ------>

        // jQuery's getJSON() method passes two arguments:
        // first the URL of the file we're requesting 
        // second a callback function that executes once the script successfully loads the data.
        // added the jQuery getJSON() method to a variable [countyLayer] to be able to reference this action later 
        // added the Leaflet GeoJson layer to a variable [datalayer] to be able to use it as an argument in a new function and get the data out of the callback function
        var countyLayer = jQuery.getJSON("data/sloCountyBoundary.geojson", function (data) {
            var dataLayer = L.geoJson(data, {
                style: function (feature) {
                    return {
                        //color: '#5E94AD',
                        color: 'orange',
                        weight: .75,
                        fillOpacity: 0,
                        fillColor: '#1f78b4'
                    };
                }
            }).addTo(map);
            // can call to new function here gets the data out of the callback function  
            map.fitBounds(dataLayer.getBounds())   
        });// end of callback function
       

        var avaLayer = jQuery.getJSON("data/combined_ava.geojson", function (data) {
            var dataLayer = L.geoJson(data, {
                style: function (feature) {
                    return {
                        weight: .75,
                        opacity: 1,
                        color: 'white',
                        fillColor: 'green',
                        dashArray: '3',
                        fillOpacity: 0.2,
                    }
                },
                filter: function (feature, layer) {
                    if (feature.properties.Name == 'Paso Robles' || feature.properties.Name == 'York Mountain' || feature.properties.Name == 'Arroyo Grande Valley' || feature.properties.Name == 'Edna Valley') {
                        return feature;
                    }

                },
                onEachFeature: function (feature, layer) {
                    console.log(feature)
                    if (feature.properties.Name == 'Paso Robles') {
                        layer.setStyle({
                            //fillColor: 'red',
                            //color: 'red',
                            //opacity: .4,
                            //fillOpacity: .4,

                        });
                    } else if (feature.properties.Name == 'York Mountain') {
                        layer.setStyle({
                            //fillColor: 'purple',
                            //color: 'purple',
                            //opacity: .4,
                            //fillOpacity: .4,
                        });
                    }

                    layer.on('mouseover', function () {
                        if (feature.properties.Name == 'Paso Robles') {
                            layer.setStyle({
                                fillColor: 'red',
                                color: 'red',
                                opacity: .4,
                                fillOpacity: .4,

                            });
                        } else if (feature.properties.Name == 'York Mountain') {
                            layer.setStyle({
                                fillColor: 'purple',
                                color: 'purple',
                                opacity: .4,
                                fillOpacity: .4,
                            });
                        } else if (feature.properties.Name == 'Arroyo Grande Valley') {
                            layer.setStyle({
                                fillColor: 'blue',
                                color: 'blue',
                                opacity: .4,
                                fillOpacity: .4,
                            });
                        } else if (feature.properties.Name == 'Edna Valley') {
                            layer.setStyle({
                                fillColor: 'orange',
                                color: 'orange',
                                opacity: .4,
                                fillOpacity: .4,
                            });
                        }
                    }); // end on mouseover
                    layer.on('mouseout', function () {
                        dataLayer.resetStyle(layer);
                    });
                    
                    var popUpText = feature.properties.Name
                    var toolTipOptions = {
                        // pane: 
                        offset: L.point(-50, 0),
                        direction:'left', //right, left, top, bottom, center, auto
                        permanent: false,
                        sticky: true,
                        interactive: false,
                        opacity: .8
                    }
                    
                    layer.bindTooltip(popUpText, toolTipOptions); // opposite order of tooltip

                    console.log(dataLayer)
                } // end onEachFeature

            }).addTo(map);
            // can call to new function here gets the data out of the callback function     
        });// end of callback function


    </script>




</body>

</html>